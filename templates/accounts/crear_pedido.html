{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-4" style="max-width: 900px;">
  <h3 class="mb-3 text-center">Crear Pedido de {{ sabor.nombre }}</h3>

  <form method="post" class="card shadow-sm border-0">
    {% csrf_token %}
    <div class="card-body">
      <div class="row g-3">

        <!-- Cantidad -->
        <div class="col-sm-4">
          <label class="form-label">Cantidad</label>
          <input type="number" name="cantidad" value="{{ cantidad }}" min="1" max="99"
                 class="form-control" oninput="recalcular()">
          <div class="form-text">Precio unitario: <b>Bs {{ precio_unit }}</b></div>
        </div>

        <!-- Método de Envío -->
        <div class="col-sm-8">
          <label class="form-label d-block">Método de Envío</label>

          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="metodo_envio" id="met_retiro"
                   value="RETIRO" checked onclick="recalcular()">
            <label class="form-check-label" for="met_retiro">
              Retiro en Tienda (sin costo)
            </label>
          </div>

          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="metodo_envio" id="met_delivery"
                   value="DELIVERY" onclick="recalcular()">
            <label class="form-check-label" for="met_delivery">
              Envío a Domicilio (Bs 5)
            </label>
          </div>
        </div>

        <!-- Dirección -->
        <div class="col-12">
          <label class="form-label">Dirección de Entrega</label>
          <input type="text" name="direccion_entrega" class="form-control"
                 placeholder="Si eliges envío a domicilio">
        </div>

        <!-- Fecha programada -->
        <div class="col-sm-6">
          <label class="form-label">Fecha de Entrega Programada (Opcional)</label>
          <input type="datetime-local" name="fecha_entrega_programada" class="form-control">
        </div>

        <!-- Observaciones -->
        <div class="col-sm-6">
          <label class="form-label">Observaciones</label>
          <input type="text" name="observaciones" class="form-control"
                 placeholder="Ej: sin maní, tocar timbre, etc.">
        </div>

        <!-- Resumen -->
        <div class="col-12">
          <div class="alert alert-secondary mb-0">
            <div><strong>Resumen</strong></div>
            <div>Subtotal: <span id="subtotal">Bs 0.00</span></div>
            <div>Envío: <span id="envio">Bs 0.00</span></div>
            <div class="fw-bold">Total: <span id="total">Bs 0.00</span></div>
          </div>
        </div>

      </div>
    </div>

    <!-- Botones -->
    <div class="card-footer bg-white border-0 d-flex gap-2">
      <a href="{% url 'catalogo' %}" class="btn btn-outline-secondary">Volver al Catálogo</a>
      <button class="btn btn-primary ms-auto" type="submit">Realizar Pedido</button>
    </div>
  </form>
</div>

<!-- Script -->
<script>
  const PRECIO = parseFloat('{{ precio_unit }}'.replace(',', '.')) || 0;
  function recalcular(){
    const qty = parseInt(document.querySelector('input[name=cantidad]').value || '1', 10);
    const delivery = document.getElementById('met_delivery').checked;
    const envio = delivery ? 5 : 0;
    const subtotal = qty * PRECIO;
    const total = subtotal + envio;
    document.getElementById('subtotal').innerText = `Bs ${subtotal.toFixed(2)}`;
    document.getElementById('envio').innerText = `Bs ${envio.toFixed(2)}`;
    document.getElementById('total').innerText = `Bs ${total.toFixed(2)}`;
  }
  recalcular();
</script>
{% endblock %}
