{% extends "base.html" %}
{% block content %}
<h2>Pedidos pendientes</h2>
<table class="table">
  <thead>
    <tr>
      <th>#</th><th>Cliente</th><th>Creado</th><th>Total</th><th></th>
    </tr>
  </thead>
  <tbody>
    {% for p in pedidos %}
      <tr>
        <td>#{{ p.id }}</td>
        <td>{{ p.cliente.nombre }}</td>
        <td>{{ p.created_at|date:"Y-m-d H:i" }}</td>
        <td>{{ p.total }}</td>
        <td class="text-end">
  <a class="btn btn-light btn-sm" href="{% url 'pedido_detalle' p.id %}">Ver</a>

  {# ✏️ Editar: solo dueño y no finalizado.
     En esta lista quizá no tenés total_pagado/saldo, así que dejamos que la vista valide pagos. #}
  {% if request.user.is_authenticated
        and p.cliente and p.cliente.usuario
        and p.cliente.usuario.email|lower == request.user.email|lower
        and p.estado not in ('ENTREGADO','CANCELADO') %}
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'pedido_editar' p.id %}">
      ✏️ Editar
    </a>
  {% endif %}
</td>

      </tr>
    {% empty %}
      <tr><td colspan="5">No hay pedidos pendientes.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
